pipeline {
    agent master

    stages {
        stage("info") {
            steps {
                echo "Node Name: ${env.NODE_NAME}"
                echo "Executor Number: ${env.EXECUTOR_NUMBER}"
                echo "Source Branch: ${env.BRANCH_NAME}"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@dockerbuild.apgsga.ch echo "Host: $( hostname ), Docker Version: $( docker --version )" )"
            }
        }

        stage("tag image") {
            steps {
                echo "make sure we have the right image"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker pull dockerregistry.apgsga.ch:5000/apgsga/keycloak:dev )"
                echo "tag the image for login-e1 and push to dockerregistry"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker tag dockerregistry.apgsga.ch:5000/apgsga/keycloak:dev dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-e1 )"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker push dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-e1 )"
            }
        }
    }
}
