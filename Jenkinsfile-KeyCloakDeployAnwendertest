pipeline {
    agent any
    
    options {
        timeout(time: 5, unit: "MINUTES")
        timestamps()
    }


    stages {
        stage("info") {
            steps {
                echo "Node Name: ${env.NODE_NAME}"
                echo "Executor Number: ${env.EXECUTOR_NUMBER}"
                echo "Source Branch: ${env.BRANCH_NAME}"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@dockerbuild.apgsga.ch echo \"Remote Host: \\\$( hostname ), Docker Version: \\\$( docker --version )\" )"
            }
        }

        stage("tag image") {
            steps {
                echo "make sure we have the right image"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker pull dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-e1 )"
                echo "tag the image for login-t1 and push to dockerregistry"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker tag dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-e1 dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-t1 )"
                sh "( ssh -o StrictHostKeyChecking=no dockerbuild-dev@lxpwi072.apgsga.ch docker push dockerregistry.apgsga.ch:5000/apgsga/keycloak:login-t1 )"
            }
        }
    }
}
